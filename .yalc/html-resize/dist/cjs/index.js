'use strict';

var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e;}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r);}var __assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},__assign.apply(this,arguments)};"function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};

var ManipuleElementsEventEnum;!function(n){n.RESIZING="resizing",n.START_RESIZE="start-resizing",n.STOP_RESIZING="stop-resizing";}(ManipuleElementsEventEnum||(ManipuleElementsEventEnum={}));var ManipuleElementsEvents=function(){function n(){}return n.createNew=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var a=new CustomEvent("".concat(n.PREFFIX).concat(e),{detail:__assign({},t)});window.dispatchEvent(a);},n.listen=function(e,t){window.addEventListener("".concat(n.PREFFIX).concat(e),(function(n){t(n.detail);}));},n.PREFFIX="manipule-elements:",n}();

var ResizePointTypeEnum;!function(e){e.TOP_LEFT="tl",e.TOP_RIGHT="tr",e.BOTTOM_LEFT="bl",e.BOTTOM_RIGHT="br",e.MIDDLE_RIGHT="mr",e.MIDDLE_LEFT="ml",e.MIDDLE_TOP="mt",e.MIDDLE_BOTTOM="mb";}(ResizePointTypeEnum||(ResizePointTypeEnum={}));var ResizePointTypeEventEnum;!function(e){e.RESIZING="resizing",e.START_RESIZE="start-resizing",e.STOP_RESIZING="stop-resizing";}(ResizePointTypeEventEnum||(ResizePointTypeEventEnum={}));var ResizePoint=function(){function e(e){if(this.onEvents={},!Object.values(ResizePointTypeEnum).includes(e))throw new Error("ResizePoint type not recognized");this.el=document.createElement("div"),this.el.classList.add("res-point",e),this.el.addEventListener("mousedown",this.initResize.bind(this),!1),this.type=e;}return e.prototype.on=function(e,n){Object.values(ResizePointTypeEventEnum).includes(e)&&(this.onEvents[e]=n);},e.prototype.send=function(e){for(var n,t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];ManipuleElementsEvents.createNew(e,t),Object.values(ResizePointTypeEventEnum).includes(e)&&(n=this.onEvents)[e].apply(n,t);},e.prototype.getElement=function(){return this.el},e.prototype.getType=function(){return this.type},e.prototype.initResize=function(e){var n=this;if(e.target){this.send(ResizePointTypeEventEnum.START_RESIZE);var t=function(e){n.send(ResizePointTypeEventEnum.RESIZING,e);},i=function(){n.send(ResizePointTypeEventEnum.STOP_RESIZING),window.removeEventListener("mousemove",t,!1),window.removeEventListener("mouseup",i,!1);};window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",i,!1);}},e}();

var ResizableShadow=function(){function e(e){this.resizeType=e,this.onStartResize=function(){},this.onStopResize=function(){},this.onResizing=function(){};var n=document.createElement("div");n.classList.add("shadow"),this.shadowElement=n;}return e.prototype.getElement=function(){return this.shadowElement},e.prototype.start=function(){var e=this;this.shadowElement.style.display="initial";var n=new ResizePoint(ResizePointTypeEnum.TOP_LEFT);n.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.TOP_LEFT);})),n.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),n.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var t=new ResizePoint(ResizePointTypeEnum.TOP_RIGHT);t.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.TOP_RIGHT);})),t.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),t.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var i=new ResizePoint(ResizePointTypeEnum.BOTTOM_LEFT);i.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.BOTTOM_LEFT);})),i.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),i.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var o=new ResizePoint(ResizePointTypeEnum.BOTTOM_RIGHT);o.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.BOTTOM_RIGHT);})),o.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),o.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var s=new ResizePoint(ResizePointTypeEnum.MIDDLE_RIGHT);s.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.MIDDLE_RIGHT);})),s.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),s.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var E=new ResizePoint(ResizePointTypeEnum.MIDDLE_LEFT);if(E.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.MIDDLE_LEFT);})),E.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),E.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();})),this.resPoints={topLeft:n,topRight:t,bottomLeft:i,bottomRight:o,middleLeft:E,middleRight:s},this.shadowElement.appendChild(n.getElement()),this.shadowElement.appendChild(t.getElement()),this.shadowElement.appendChild(i.getElement()),this.shadowElement.appendChild(o.getElement()),this.shadowElement.appendChild(E.getElement()),this.shadowElement.appendChild(s.getElement()),this.resizeType===ResizableType.RESIZABLE_TYPE_IMAGE){var R=new ResizePoint(ResizePointTypeEnum.MIDDLE_TOP);R.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.MIDDLE_TOP);})),R.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),R.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();}));var T=new ResizePoint(ResizePointTypeEnum.MIDDLE_BOTTOM);T.on(ResizePointTypeEventEnum.RESIZING,(function(n){e.onResizing(n,ResizePointTypeEnum.MIDDLE_BOTTOM);})),T.on(ResizePointTypeEventEnum.START_RESIZE,(function(){e.onStartResize();})),T.on(ResizePointTypeEventEnum.STOP_RESIZING,(function(){e.onStopResize();})),this.resPoints.middleBottom=T,this.resPoints.middleTop=R,this.shadowElement.appendChild(R.getElement()),this.shadowElement.appendChild(T.getElement());}},e.prototype.finish=function(){var e,n;this.resPoints&&(this.resPoints.topLeft.getElement().remove(),this.resPoints.topRight.getElement().remove(),this.resPoints.bottomLeft.getElement().remove(),this.resPoints.bottomRight.getElement().remove(),this.resPoints.middleLeft.getElement().remove(),this.resPoints.middleRight.getElement().remove(),null===(e=this.resPoints.middleBottom)||void 0===e||e.getElement().remove(),null===(n=this.resPoints.middleTop)||void 0===n||n.getElement().remove());},e}();

var ResizableType;!function(e){e.RESIZABLE_TYPE_TEXT="text",e.RESIZABLE_TYPE_IMAGE="image";}(ResizableType||(ResizableType={}));var Resizable=function(){function e(e){var t=e.contentEl,i=e.type,n=e.wrapperLeft;this.wrapperLeft=0,this.onStartResize=function(){},this.onStopResize=function(){},t.parentElement&&t.parentElement.classList.contains("content-wrapper")?(t.parentElement.classList.add(i,"resizable"),this.resizableElement=t.parentElement):this.resizableElement=t,this.type=i,this.shadowElement=null,this.wrapperLeft=n,this.initEvents();}return e.prototype.initEvents=function(){var e=this;this.resizableElement.addEventListener("click",this.handleClick.bind(this),!0),this.shadowElement=new ResizableShadow(this.type),this.shadowElement.onStartResize=function(){e.onStartResize();},this.shadowElement.onStopResize=function(){e.onStopResize();},this.shadowElement.onResizing=function(t,i){var n=t.clientX,s=t.clientY;e.doResize(n,s,i);},this.resizableElement.appendChild(this.shadowElement.getElement());},e.prototype.handleClick=function(){if(this.resizableElement.classList.add("selected"),!this.shadowElement||this.resizableElement.classList.contains("is-dragging"))return !1;this.shadowElement.start();},e.prototype.removeSelection=function(){this.resizableElement.classList.remove("selected"),this.shadowElement&&this.shadowElement.finish();},e.prototype.getElement=function(){return this.resizableElement},e}();

var Drag=function(){function t(t,e,s){this.contentEl=t,this.wrapperBounds=e,this.wrapperElement=s,this.pos1=0,this.pos2=0,this.pos3=0,this.pos4=0,this.classesAllowedToDrag=["shadow","content"],this.boundStartDragEventHandler=this.startDrag.bind(this),this.initEvents();}return t.prototype.initEvents=function(){this.contentEl.addEventListener("mousedown",this.initDrag.bind(this),!1);},t.prototype.initDrag=function(t){var e=this;if(this.isElementCanBeDragged(t.target)){this.pos3=t.clientX,this.pos4=t.clientY,this.contentEl.classList.add("is-dragging");var s=function(){e.contentEl.classList.remove("is-dragging"),e.wrapperElement.removeEventListener("mouseup",s,!1),e.wrapperElement.removeEventListener("mousemove",e.boundStartDragEventHandler,!1),e.wrapperElement.removeEventListener("mouseleave",s,!1);};this.wrapperElement.addEventListener("mouseup",s,!1),this.wrapperElement.addEventListener("mousemove",this.boundStartDragEventHandler,!1),this.wrapperElement.addEventListener("mouseleave",s,!1);}},t.prototype.startDrag=function(t){this.pos1=this.pos3-t.clientX,this.pos2=this.pos4-t.clientY,this.pos3=t.clientX,this.pos4=t.clientY;var e=this.contentEl.offsetTop-this.pos2,s=this.contentEl.offsetLeft-this.pos1;s+this.wrapperBounds.x>this.wrapperBounds.x&&s+this.contentEl.clientWidth<this.wrapperBounds.w&&(this.contentEl.style.left="".concat(s,"px")),e+this.wrapperBounds.y>this.wrapperBounds.y&&e+this.contentEl.clientHeight<this.wrapperBounds.h&&(this.contentEl.style.top="".concat(e,"px"));},t.prototype.isElementCanBeDragged=function(t){var e;return !t.classList.contains("is-editing")&&!(null===(e=t.parentElement)||void 0===e?void 0:e.classList.contains("is-editing"))&&this.classesAllowedToDrag.filter((function(e){return t.classList.contains(e)})).length>0},t}();

var ResizableText=function(e){function t(t){var i=t.contentEl,n=t.wrapperLeft;return i.classList.add("content"),e.call(this,{contentEl:i,wrapperLeft:n,type:ResizableType.RESIZABLE_TYPE_TEXT})||this}return __extends(t,e),t.prototype.doResize=function(e,t,i){var n=this.resizableElement.getBoundingClientRect(),s=n.left,l=n.width,o=n.height,r=this.calculateToGrowSize(i,e,s,l);if(!(r<1&&o<20)){if(this.resizableElement.style.width=l+r+"px",[ResizePointTypeEnum.MIDDLE_LEFT,ResizePointTypeEnum.TOP_LEFT,ResizePointTypeEnum.BOTTOM_LEFT].includes(i)&&(this.resizableElement.style.left=s-this.wrapperLeft-r+"px"),i===ResizePointTypeEnum.TOP_RIGHT||i===ResizePointTypeEnum.TOP_LEFT){var p=parseFloat(window.getComputedStyle(this.resizableElement,null).getPropertyValue("top"))-r/8+"px";this.resizableElement.style.top=p;}if(![ResizePointTypeEnum.MIDDLE_LEFT,ResizePointTypeEnum.MIDDLE_RIGHT].includes(i)){var T=parseFloat(window.getComputedStyle(this.resizableElement,null).getPropertyValue("font-size"));this.resizableElement.style.fontSize=T+r/8+"px";}}},t.prototype.calculateToGrowSize=function(e,t,i,n){return [ResizePointTypeEnum.MIDDLE_LEFT,ResizePointTypeEnum.TOP_LEFT,ResizePointTypeEnum.BOTTOM_LEFT].includes(e)?i-t:t-(i+n)},t}(Resizable);

var ResizableImage=function(e){function t(t){var i=t.contentEl,n=t.wrapperLeft,o=this;return i.classList.add("content"),(o=e.call(this,{contentEl:i,wrapperLeft:n,type:ResizableType.RESIZABLE_TYPE_IMAGE})||this).imageElement=i,o}return __extends(t,e),t.prototype.doResize=function(e,t,i){var n=this.resizableElement.getBoundingClientRect(),o=n.left,s=n.top,l=this.imageElement.getBoundingClientRect(),r=l.width,p=l.height,E=this.calculateToGrowSize(i,e,t,o,r,p,s);if(!(E<1&&p<20)){if(!this.isMiddlePoint(i)){var T=p/r;this.imageElement.style.height=p+T*E+"px";}if(this.isMiddleVerticalPoint(i)?this.imageElement.style.height=p+E+"px":(this.isMiddleHorizontalPoint(i),this.imageElement.style.width=r+E+"px"),[ResizePointTypeEnum.MIDDLE_LEFT,ResizePointTypeEnum.TOP_LEFT,ResizePointTypeEnum.BOTTOM_LEFT].includes(i)&&(this.resizableElement.style.left=o-this.wrapperLeft-E+"px"),i===ResizePointTypeEnum.TOP_RIGHT||i===ResizePointTypeEnum.TOP_LEFT||i===ResizePointTypeEnum.MIDDLE_TOP){var a=parseFloat(window.getComputedStyle(this.resizableElement,null).getPropertyValue("top"))-E+"px";this.resizableElement.style.top=a;}}},t.prototype.calculateToGrowSize=function(e,t,i,n,o,s,l){return e===ResizePointTypeEnum.MIDDLE_TOP?l-i:e===ResizePointTypeEnum.MIDDLE_BOTTOM?i-(l+s):[ResizePointTypeEnum.MIDDLE_LEFT,ResizePointTypeEnum.TOP_LEFT,ResizePointTypeEnum.BOTTOM_LEFT].includes(e)?n-t:t-(n+o)},t.prototype.isMiddleHorizontalPoint=function(e){return e===ResizePointTypeEnum.MIDDLE_LEFT||e===ResizePointTypeEnum.MIDDLE_RIGHT},t.prototype.isMiddleVerticalPoint=function(e){return e===ResizePointTypeEnum.MIDDLE_TOP||e===ResizePointTypeEnum.MIDDLE_BOTTOM},t.prototype.isMiddlePoint=function(e){return this.isMiddleHorizontalPoint(e)||this.isMiddleVerticalPoint(e)},t}(Resizable);

var ResizableFactory=function(){function e(){}return e.make=function(e,t){var r,o,a,i;if(t===ResizableType.RESIZABLE_TYPE_IMAGE)return new ResizableImage({contentEl:e,wrapperLeft:null!==(o=null===(r=document.getElementById("wrapper"))||void 0===r?void 0:r.offsetLeft)&&void 0!==o?o:0});if(t===ResizableType.RESIZABLE_TYPE_TEXT)return new ResizableText({contentEl:e,wrapperLeft:null!==(i=null===(a=document.getElementById("wrapper"))||void 0===a?void 0:a.offsetLeft)&&void 0!==i?i:0});throw new Error("Resizable type: ".concat(t," not found"))},e}();

var Rotate=function(){function t(t,e){this.contentElement=t,this.wrapperElement=e,this.rotation=0,this.mouseCoords={x:0,y:0},this.rotatePoint=document.createElement("div"),this.rotatePoint.classList.add("rotate-point"),this.rotatePoint.innerHTML='<?xml version="1.0" encoding="utf-8"?>\n        <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12.5 20.5C17.1944 20.5 21 16.6944 21 12C21 7.30558 17.1944 3.5 12.5 3.5C7.80558 3.5 4 7.30558 4 12C4 13.5433 4.41128 14.9905 5.13022 16.238M1.5 15L5.13022 16.238M6.82531 12.3832L5.47107 16.3542L5.13022 16.238" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>',this.contentElement.appendChild(this.rotatePoint),this.boundStartDragEventHandler=this.startDrag.bind(this),this.initEvents();}return t.prototype.initEvents=function(){this.rotatePoint.addEventListener("mousedown",this.startMoving.bind(this),!1);},t.prototype.startMoving=function(t){var e=this,n=function(){e.contentElement.classList.remove("is-rotating"),e.wrapperElement.removeEventListener("mouseup",n,!1),e.wrapperElement.removeEventListener("mousemove",e.boundStartDragEventHandler,!1);};this.contentElement.classList.add("is-rotating"),this.wrapperElement.addEventListener("mouseup",n,!1),this.wrapperElement.addEventListener("mousemove",this.boundStartDragEventHandler,!1),this.mouseCoords.x=t.clientX,this.mouseCoords.y=t.clientY;},t.prototype.startDrag=function(t){var e=t.clientX,n=t.clientY,o=this.rotatePoint.getBoundingClientRect(),i=n<o.y+o.height/2,s=this.mouseCoords.x!==e?this.mouseCoords.x-e:this.mouseCoords.y-n;i?this.rotation-=s:this.rotation+=s,this.mouseCoords.x=t.clientX,this.mouseCoords.y=t.clientY,this.contentElement.style.transform="rotate(".concat(this.rotation,"deg)");},t}();

var ElementManipulable=function(){function t(t,e,n,i,r){this.contentEl=t,this.wrapperElement=e,this.type=r,this.wrapperBounds={w:0,h:0,x:0,y:0},this.onStartResize=function(){},this.onStopResize=function(){},this.onElementSelect=function(t){},this.resizableElement=null,this.contentEl.setAttribute("contenteditable","false"),this.contentWrapper=document.createElement("div"),this.contentWrapper.classList.add("content-wrapper"),this.contentWrapper.appendChild(this.contentEl),this.wrapperElement.appendChild(this.contentWrapper),this.id=String((new Date).getTime());var o=this.wrapperElement.getBoundingClientRect(),s=o.x,p=o.y,a=o.width,l=o.height;this.wrapperBounds.h=l,this.wrapperBounds.w=a,this.wrapperBounds.x=s,this.wrapperBounds.y=p,this.configureElements(i,n),this.initEvents();}return t.prototype.configureElements=function(t,e){var n=this;t&&new Drag(this.contentWrapper,this.wrapperBounds,this.wrapperElement),e&&(this.resizableElement=ResizableFactory.make(this.contentEl,this.type),this.resizableElement.onStartResize=function(){n.onStartResize();},this.resizableElement.onStopResize=function(){n.onStopResize();}),new Rotate(this.contentWrapper,this.wrapperElement),this.setCenterPosition();},t.prototype.initEvents=function(){this.contentWrapper.addEventListener("dragstart",(function(t){t.preventDefault();})),this.contentWrapper.addEventListener("click",this.handleSelectedElement.bind(this),!1);},t.prototype.handleSelectedElement=function(){this.onElementSelect(this.id);},t.prototype.removeSelection=function(){var t;this.contentWrapper.classList.remove("is-editing"),this.contentEl.setAttribute("contenteditable","false"),null===(t=this.resizableElement)||void 0===t||t.removeSelection();},t.prototype.getElement=function(){return this.contentEl},t.prototype.getId=function(){return this.id},t.prototype.getType=function(){return this.type},t}();

var ImageElementManipulable=function(t){function e(e,n,i,o){var l=t.call(this,e,n,i,o,ResizableType.RESIZABLE_TYPE_IMAGE)||this;return l.contentEl=e,l.wrapperElement=n,l}return __extends(e,t),e.prototype.setCenterPosition=function(){this.contentEl.onload=this.onLoadImageContent.bind(this);},e.prototype.onLoadImageContent=function(){var t=this.contentWrapper.getBoundingClientRect(),e=t.height,n=t.width;this.contentWrapper.style.left="calc(50% - ".concat(n/2,"px)"),this.contentWrapper.style.top="calc(50% - ".concat(e/2,"px)");var i=this.contentEl.getBoundingClientRect(),o=i.width,l=i.height;this.contentEl.style.width="".concat(o,"px"),this.contentEl.style.height="".concat(l,"px");},e}(ElementManipulable);

var StyleConfigEnum;!function(i){i.BOLD="bold",i.COLOR="color",i.ITALIC="italic",i.STRIKE_THROUGH="strikeThrough",i.SUPERSCRIPT="superscript",i.SUBSCRIPT="subscript",i.UNDERLINE="underline";}(StyleConfigEnum||(StyleConfigEnum={}));

var DomUtils=function(){function e(){}return e.prototype.getDeepestNodes=function(e){var t=[],n=[];if(!e.collapsed){for(var o=e.startContainer,r=e.endContainer,d=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null),a=d.currentNode=o;a;){if(a.nodeType===Node.TEXT_NODE&&a.textContent&&a.textContent.trim().length>0&&e.intersectsNode(a)){var i=a.parentElement;i&&this.isStyledTextNode(i)?n.includes(i)||n.push(i):e.intersectsNode(a)&&t.push(a);}if(a===r)break;a=d.nextNode();}for(var s=0,l=t;s<l.length;s++){var p=l[s];(N=this.createSpanIfNeeded(p,e))&&!n.includes(N)&&n.push(N);}}if(1===n.length){p=n[0];if(!this.hasStyledTextNode(p)){var N=document.createElement("span");e.surroundContents(N),n=[N];}}return n},e.prototype.hasStyledTextNode=function(e){return e.nodeType===Node.ELEMENT_NODE&&e.style.length>0},e.prototype.getSelectedRoot=function(e){var t,n=[],o=e.getRangeAt(0);if(o.collapsed){var r=e.anchorNode;if(r){var d=document.createElement("span");if(r&&"SPAN"===r.tagName)d=r;else {var a=r.parentNode;a&&"SPAN"===a.tagName?d=r.parentNode:(d.textContent=" ​",r.nodeType===Node.TEXT_NODE?null===(t=r.parentNode)||void 0===t||t.insertBefore(d,r.nextSibling):r.nodeType===Node.ELEMENT_NODE&&r.appendChild(d));}n=[d];for(var i=o.endContainer.nextSibling;i&&i.nodeType!==Node.TEXT_NODE;)i=i.nextSibling;o.setStart(d,1),o.setEnd(d,1),e.removeAllRanges(),e.addRange(o);}}else {var s=e.getRangeAt(0);n=this.getDeepestNodes(s),console.log(3333,n);}return n},e.prototype.createSpanIfNeeded=function(e,t){if(e.nodeType!==Node.TEXT_NODE||!e.textContent)return null;var n=e.textContent,o=e===t.startContainer?t.startOffset:0,r=e===t.endContainer?t.endOffset:n.length;if(0===r||o===n.length||o===r)return null;var d=document.createElement("span");return d.textContent=n.substring(o,r),this.replaceNodeWithSpan(e,d,o,r),d},e.prototype.replaceNodeWithSpan=function(e,t,n,o){var r=e.textContent,d=e.parentNode;if(d&&r){var a=document.createTextNode(r.substring(0,n)),i=document.createTextNode(r.substring(o));d.insertBefore(a,e),d.insertBefore(t,e),d.insertBefore(i,e),d.removeChild(e);}},e.prototype.isStyledTextNode=function(e){return !!e&&!e.classList.contains("on-codemerge")},e.prototype.isStyleApplied=function(e,t,n){return n(e,t)},e.prototype.applyStyleToDeepestNodes=function(e,t,n,o){var r,d=document.createDocumentFragment();n(e,t,o),null===(r=null==e?void 0:e.parentNode)||void 0===r||r.insertBefore(d,e);},e.prototype.removeStyleFromDeepestNodes=function(e,t,n){var o;if(e.nodeType===Node.ELEMENT_NODE){var r=e;if(this.isStyledTextNode(r)&&(n(r,t),!r.getAttribute("style")&&"SPAN"===r.tagName)){for(var d=document.createDocumentFragment();r.firstChild;)d.appendChild(r.firstChild);null===(o=r.parentNode)||void 0===o||o.replaceChild(d,r);}}},e}();

var _a;var styleConfigConstant=(_a={},_a[StyleConfigEnum.BOLD]={name:"Bold",property:"fontWeight",enabledValue:"bold",isComplex:!1},_a[StyleConfigEnum.ITALIC]={name:"Italic",property:"fontStyle",enabledValue:"italic",isComplex:!1},_a[StyleConfigEnum.UNDERLINE]={name:"Underline",property:"textDecoration",enabledValue:"underline",isComplex:!0},_a[StyleConfigEnum.STRIKE_THROUGH]={name:"Strike Through",property:"textDecoration",enabledValue:"line-through",isComplex:!0},_a[StyleConfigEnum.SUPERSCRIPT]={name:"Superscript",property:"verticalAlign",enabledValue:"super",isComplex:!1},_a[StyleConfigEnum.SUBSCRIPT]={name:"Subscript",property:"verticalAlign",enabledValue:"sub",isComplex:!1},_a[StyleConfigEnum.COLOR]={name:"Color",property:"color",enabledValue:"#000000",isComplex:!1},_a);

var StyleManager=function(){function t(){}return t.prototype.set=function(t,e,o){var n=styleConfigConstant[e];if(n){var r=null!=o?o:n.enabledValue;n.isComplex?this.setComplexStyle(t,n.property,r):t.style[n.property]=r;}},t.prototype.remove=function(t,e){var o=styleConfigConstant[e];o&&(o.isComplex?this.removeComplexStyle(t,o.property,o.enabledValue):t.style[o.property]=null);},t.prototype.has=function(t,e){var o=styleConfigConstant[e];if(!o)return !1;var n=t.style[o.property];return ""!==n||n===o.enabledValue},t.prototype.setComplexStyle=function(t,e,o){var n,r=null===(n=t.style[e])||void 0===n?void 0:n.toString().split(" ");r&&!r.includes(o)&&(r.push(o),t.style[e]=r.join(" ").trim());},t.prototype.removeComplexStyle=function(t,e,o){var n,r=null===(n=t.style[e])||void 0===n?void 0:n.toString().split(" ").filter((function(t){return t!==o}));r&&(t.style[e]=r.join(" ").trim());},t}();

var TextElementManipulable=function(e){function t(t,n,l,o){var i=e.call(this,t,n,l,o,ResizableType.RESIZABLE_TYPE_TEXT)||this;return i.contentEl=t,i.wrapperElement=n,i.domUtils=new DomUtils,i.styleManager=new StyleManager,i.initEventsText(),i}return __extends(t,e),t.prototype.initEventsText=function(){var e=this;this.contentWrapper.addEventListener("dblclick",(function(t){t.target.classList.contains("shadow")&&(t.target.style.display="none"),e.contentWrapper.classList.add("is-editing"),e.contentEl.setAttribute("contenteditable","true");}),!1);},t.prototype.setCenterPosition=function(){var e=this.contentWrapper.getBoundingClientRect(),t=e.height,n=e.width;this.contentWrapper.style.left="calc(50% - ".concat(n/2,"px)"),this.contentWrapper.style.top="calc(50% - ".concat(t/2,"px)");},t.prototype.setTextFont=function(e){this.contentEl.style.fontFamily=e;},t.prototype.toggleBoldInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.BOLD);},t.prototype.setColorInSelection=function(e){this.appplyStyleInTextSelected(StyleConfigEnum.COLOR,e);},t.prototype.toggleItalicInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.ITALIC);},t.prototype.toggleStrikeThroughInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.STRIKE_THROUGH);},t.prototype.toggleSuperscriptInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.SUPERSCRIPT);},t.prototype.toggleSubscriptInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.SUBSCRIPT);},t.prototype.toggleUnderlineInSelection=function(){this.appplyStyleInTextSelected(StyleConfigEnum.UNDERLINE);},t.prototype.appplyStyleInTextSelected=function(e,t){var n,l=this,o=window.getSelection();o&&(null!==(n=this.domUtils.getSelectedRoot(o))&&void 0!==n?n:[]).forEach((function(n){l.domUtils.isStyleApplied(n,e,l.styleManager.has.bind(l.styleManager))?l.domUtils.removeStyleFromDeepestNodes(n,e,l.styleManager.remove.bind(l.styleManager)):l.domUtils.applyStyleToDeepestNodes(n,e,l.styleManager.set.bind(l.styleManager),t);}));},t}(ElementManipulable);

var Wrapper=function(){function e(e){var t=e.el;this.onElementSelect=function(e){},this.onNoneElementSelect=function(){},this.wrapperElement=t,this.isResizing=!1,this.elements=new Map,this.wrapperElement.style.position="relative",this.initEvents();}return e.prototype.addElement=function(e){var t=this.makeElement(e);this.addElementManipulate(t);},e.prototype.makeElement=function(e){var t=e.contentEl,n=e.isResizable,i=void 0!==n&&n,l=e.isDragabble,o=void 0!==l&&l;return "IMG"===t.nodeName?new ImageElementManipulable(t,this.wrapperElement,i,o):new TextElementManipulable(t,this.wrapperElement,i,o)},e.prototype.addElementManipulate=function(e){var t=this;e.onStartResize=function(){t.isResizing=!0;},e.onStopResize=function(){setTimeout((function(){t.isResizing=!1;}),100);},e.onElementSelect=function(e){var n=t.elements.get(e);if(!n)throw new Error("Element with id: ".concat(e," not found."));t.elements.forEach((function(t){t.getId()!==e&&t.removeSelection();})),t.onElementSelect(n);};var n=e.getId();this.elements.set(n,e);},e.prototype.initEvents=function(){this.wrapperElement.addEventListener("click",this.handleClick.bind(this),!0);},e.prototype.handleClick=function(e){this.isResizing||e.target===this.wrapperElement&&(this.elements.forEach((function(e){e.removeSelection();})),this.onNoneElementSelect());},e}();

exports.Wrapper = Wrapper;
